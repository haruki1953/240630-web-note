背景
```
vps上安装了1panel，并通过1panel安装了OpenResty（Web服务器）
在prokbun买的域名 https://porkbun.com/
已将域名添加到cloudflare，使用cloudflare的dns和代理
```

简单说明
```
静态网站部署
首先解析一个域名到自己vps的ip
然后通过1panel创建站点并配置
最后将打包好的网站文件上传到vps
```

细节配置
```
cloudflare配置，prokbun、域名相关配置
1panel安装，网站配置浏览器缓存优化
```


## 解析域名
通过cloudflare的dns解析域名。
```
选择已添加的域名 -> dns -> 记录 -> 添加记录 -> 填写并保存
自己一直在用cf的代理，开启代理比较好
```
![](assets/Pasted%20image%2020250829214445.png)


## 创建站点
通过1panel创建站点
```
网站 -> 创建 -> 静态网站 -> 填写域名并保存
```
![](assets/Pasted%20image%2020250829214943.png)

配置https证书
```
点击刚刚创建的网站进入网站设置 -> https -> 启用HTTPS -> 填写配置
说明一下，证书可以在 网站-证书页面生成，自己用的是自签名证书（证书-sakiko.top）
因为使用了cf代理，cf会帮自己提供有效公开可信的证书，如果不用cf代理，就要自己申请有效证书（也可以在网站-证书页面申请并自动续签，要提供自己cloudflare的令牌之类的）
```
![](assets/Pasted%20image%2020250829215742.png)

访问刚刚创建的站点 https://kippu.sakiko.top/ 出现这样的页面就是成功了
![](assets/Pasted%20image%2020250829220506.png)


## 上传网站文件
通过1panel上传文件
```
网站设置 -> 网站目录 -> root 目录 -> 点击路径旁的文件夹图标即可跳转至文件管理
```
![](assets/Pasted%20image%2020250829220847.png)
![](assets/Pasted%20image%2020250829220920.png)


## cloudflare配置
在cloudflare添加域名 https://www.cloudflare.com/zh-cn/ ，跟着官方的引导就行

DNS配置
```
DNS -> 设置
启用 DNSSEC ，根据其弹出的说明，需要在prokbun也进行配置（其实这个好像不配置也行）
```

SSL/TLS配置
```
SSL/TLS -> 概述 -> SSL/TLS 加密 ，配置为“完全”比较好（选自动也可以）

SSL/TLS -> 边缘证书
开启 始终使用 HTTPS
关闭 自动 HTTPS 重写
```

缓存配置
```
缓存 -> 配置
浏览器缓存 TTL 遵循现有标头（需自己配置缓存），或者设置为几个月（自己不控制缓存）
```


## 1panel配置
安装1panel
```
https://github.com/1Panel-dev/1Panel
https://docs.1panel.pro/
```

为1panel配置反向代理，使用域名访问1panel
```
1panel安装后，是使用ip+端口号访问，而且是http。配置反向代理后会更安全
在cf解析一个域名
1panel -> 网站 -> 网站 -> 创建 -> 反向代理
主域名填写刚刚解析的域名，代理地址填写ip+端口号

为反向代理的内容配置一下浏览器缓存更好
网站设置 -> 反向代理 -> 源文
注释掉其中的 add_header Cache-Control no-cache; 
在其尾部（花括号内）添加
```
```nginx
if ( $uri ~* "\.(gif|png|jpg|css|js|woff|woff2)$" )
{
	expires 30d;
	add_header Cache-Control "public";
}
```

修改ssh端口
```
修改ssh端口避免被恶意扫描
1panel -> 系统 -> SSH管理 -> 配置 -> 修改连接端口
```

开启并配置防火墙
```
1panel -> 系统 -> 防火墙
```

为静态网站配置浏览器缓存
```
1panel -> 网站 -> 网站 -> 网站设置 -> 配置文件
在其尾部（花括号内）添加
```
```nginx
location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
{
	expires      30d;
	add_header Cache-Control "public";
	error_log /dev/null;
	access_log /dev/null;
}

location ~ .*\.(js|css)?$
{
	expires      30d;
	add_header Cache-Control "public";
	error_log /dev/null;
	access_log /dev/null;
}
```


