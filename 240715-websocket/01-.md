## websocket概述

http请求只能由客户端发起
- 轮询（浪费带宽，实时性差，服务器压力大）（长轮询）

WebSocket，
- 2008年提出，2011年成为标准
- HTML5新增的协议
- 可以在浏览器和服务器之间建立一个全双工的通信通道

### 通信流程
1. 浏览器发起http请求，请求建立WebSocket连接
![](assets/Pasted%20image%2020240715153852.png)

2. 服务器响应同意协议更改
![](assets/Pasted%20image%2020240715153940.png)

3. 相互发送数据。discord就有ws
![](assets/Pasted%20image%2020240715154603.png)

![](assets/Pasted%20image%2020240715154737.png)


- WebSocket协议建立在tcp协议基础上的，所以服务器端也容易实现，不同的语言都有支持
- tcp协议是全双工协议，http协议基于它，但设计成了单向的
- WebSocket没有同源限制


## 实现websocket服务端
https://www.bilibili.com/video/BV1hF411k7bj?p=4

- 监听接口，也和http一样需要监听接口
- onOpen，连接时触发，保存session
- onMessage，接收到客户端消息时触发
- onClose，断开连接时触发，移除session
- send，发送数据


## 实现websocket客户端
```js
let ws = new WebSocket("ws://localhost:8080/myWs1")
ws.onopen = function (){
	ws.send("hello")
}
ws.onmessage = function (message){
	console.log(message.data)
}
```
