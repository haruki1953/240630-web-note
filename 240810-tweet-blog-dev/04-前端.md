先修改完善一下以前自己整理的前端模板
- https://github.com/haruki1953/sakiko-utils-vue3/tree/682e24b674d16e6ed88b50e657db72d1c65052f1

新建前端 tweet-blog-vue3
- 下载自己原先的模板的 [Source code (zip)](https://github.com/haruki1953/sakiko-utils-vue3/archive/refs/tags/sakiko-vue3-frame-v0.1.1.zip) ，解压
- pnpm i 安装依赖，试运行，修改标题等基本内容
- 创建版本库，提交推送

vue代码在编辑器可能有报错，关闭Hybrid Mode即可（如果已经关闭就开启再关闭）

感觉vscode有卡顿的问题，可能对于vue前端这样复杂的项目来说，类型推断上限自己调的有点高了，调回160吧
- [让VScode浮窗显示完整的ts类型定义](笔记/让VScode浮窗显示完整的ts类型定义.md)
- 还是有问题，内存占用真是大，更新vscode吧，从1.85更新至了1.92。啊这，没有改善，好像还更严重了

## 前端开发计划
### 一期
- 首页，帖子
	- [x] 帖子分组处理【完成了一半】
	- [x] 无限滚动
	- [ ] 帖子删除，回收站
	- [ ] 帖子回复
	- [ ] 帖子修改
- 帖子页面
	- [ ] 显示回复
	- [ ] 没有回帖时、空状态，且不用双列
- 帖子发送
	- [x] 图片选择、上传
	- [x] 帖子信息设置【完成了一半】
- 相册功能，管理图片
	- [x] 无限滚动
	- [x] 修改alt
	- [ ] 删除图片、原图
	- [ ] 删除全部（未引用）、原图
- 收藏功能【TODO】
- 管理功能，修改基本参数【TODO】
- 整体功能完善【TODO】


## 登录
```
整理http请求工具 `src\utils\http.ts`
创建stores auth
新建路由
```


## 基本的帖子功能
- 先写基本的样式
- 请求数据，整理数据
- 帖子发送弹窗样式
- 帖子发送逻辑

### 帖子页面布局
用自动外边距居中一个宽度，然后用栅格分为左大右小的两栏

### 首页帖子
使用 PostGroup 最为最基本的显示模块，其中包含多个PostCard。将一个帖子对象的数组传入 PostGroup 以显示多个帖子
- 分页数据处理
- 显示帖子 多组件完成
- 限制个数 无限滚动

#### 分页数据处理
创建 PostStore
```ts
// src\types\data.d.ts
export interface PostData extends Post {
  parentPost: PostBase | null
}

// src\stores\modules\post.ts
const postList = ref<PostData[][]>([])
```

请求 postGetByCursorApi 获取帖子数据

处理数据
- 转为 `PostInStore[][]` 这种格式
- 将其中符合条件的合并（等帖子发送做好后再调试更方便）
```
将有关系的帖子合并在一起
调整顺序，递归处理回复与回复的回复
```

（先就这样显示）
![](assets/Pasted%20image%2020240823204041.png)


#### 无限滚动
```
可以以一个数字10为基准进行限制
无图片的帖子记1，有图片的记2
算了，还是简单的以6来算吧（一次6个帖子组）
```

### 帖子搜索
```
通过设置qurey实现
```


### 帖子页面
- 请求帖子
- 显示主帖、父贴、回复
- 有回复按钮可以添加回复
```
【关于帖子的缓存】
已经请求过的，保存在store，持久化
有一个标记数组，保存在本次网页被请求的帖子id（不持久化）

在进入帖子页面时，尝试在store中寻找帖子，用来占位（没找到则用骨架屏）
接下来再判断id，如果id不存在于数组，则请求并覆盖；如果存在则不请求（加入ws后，可根据ws消息判断是否已更新）
```

- 解决从帖子页面返回时，页面会重新回到顶部，体验差
```
路由滚动行为定制 scrollBehavior
savedPosition 保留有位置信息时滚动到原先位置

postStore.resetLimited()不再在首页页面执行，而是在路由
跳转至首页或其他包含无限滚动的页面时，重置显示限制

```

- 动画
- https://cn.vuejs.org/guide/built-ins/transition
- https://cn.vuejs.org/guide/built-ins/transition-group
```
感觉必须改一下路由滚动策略了，
最好在页面渲染后再在组件内进行回到顶部，
这样对动画更友好

算了，给帖子取消动画吧。不过骨架屏的动画效果不错，保留
```


### 帖子发送
编写一个新页面，来实现帖子发送，也能实现帖子修改、回复
- 通过store，来控制其数据
- 在任何一个地方（首页、PostCard），都可以调用store来转到此页面，这样可以在跳转时设置更多的信息
```
双列布局

封装顶栏TopBar，返回、发送功能

图片上传
上传状态处理

帖子发送
设置日期（信息设置对话框）
图片大图查看
图片列表，选择图片
```

### 帖子回复
在store中储存infoForSend，以此来判断是发帖还是回复
在跳转时，需调用postStore，其中会修改infoForSend
```
有一个问题，帖子回复后，再到帖子页面，不会刷新
这是因为 requestedPostIds 中已保存帖子id

在 requestedPostIds 去除帖子id，并尝试去除所有有关系的（父贴、一级回复）
有点麻烦了，这样吧，requestedPostIds直接清空
```

### 帖子修改
后端要改一改，禁止 parentPostId 为当前id

### 帖子删除
```
调用postUpdateApi({ id: props.data.id, isDeleted: true })来删除

删除后不进行reGetPost，不然会导致页面重排
删除后更新postList，将postList中对应的帖子设置为isDeleted，postStore.updatePostListToDeleted(props.data.id)

因为数据发生变化，所以需postStore.resetPostRequested()

对于帖子永久删除，改一下后端，可选是否也删除图片
如果也删除了图片，需将执行imagesStore.setNeedReget()
```


## 图片功能
### 图片大图查看
```
在layout中插入一个组件，绝对定位，遮罩
通过store控制其显示与隐藏
放弃，改为使用el-image自带的图片预览
```


### 相册页面
```
封装一个图片列表，显示store中的图片
两种模式：单选 与 多选，通过v-model控制选中的图片（数组）
单选给相册页面使用，多选主要供帖子发送页面使用

单选图片后，可以预览图片、操作图片
在大屏是在左侧显示操作框，小屏时弹出对话框
```

### 信息设置对话框
v-model 复习 https://cn.vuejs.org/guide/components/v-model


### 【TODO】
图片删除、原图删除
