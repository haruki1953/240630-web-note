- 公共
	- 登录接口
	- 获取帖子
- 系统管理
	- 修改登录信息
- 数据操作
	- 帖子
	- 图片

```
{
    "code": 1,
    "message": "登录失败"
}
响应体code设计：最少四位数字，后三位代表具体错误，前几位代表错误类别

1登录错误
1001用户名或密码错误
1002多次登录失败关闭登录


```

# 公共接口

## 管理员登录

**接口URL：** `/public/admin-login`  
**调用方式：** POST  

### 请求参数

#### Body 参数 （application/json）

```ts
type AdminLoginJsonType = {
    username: string;
    password: string;
}
const username = z.string().regex(/^[a-zA-Z0-9_]{1,32}$/, {
  message: '用户名格式错误，长度1到32，只能包含字母、数字和下划线'
})
const password = z.string().regex(/^[a-zA-Z0-9_]{6,32}$/, {
  message: '密码格式错误，长度6到32，只能包含字母、数字和下划线'
})
```

**示例（curl）**

```sh
curl -X POST \
  http://127.0.0.1:3000/public/admin-login \
  -H 'Content-Type: application/json' \
  -d '{
    "username": "example_user",
    "password": "example_password"
}'
```

### 返回响应

成功 200

```json
{
    "code":0,
    "message":"登录成功",
    "data":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiIsImlhdCI6MTcwODczOTMxNCwiZXhwIjoxNzE5MTA3MzE0fQ.KfieByY-iy-aVQUQqwBVTT8WLn1ZJXyIFwMrHMsQ_Lc"
}
```

失败 400

```json
{
    "code": 1,
    "message": "登录失败"
}
```



# 管理系统

## 修改用户名与密码

**接口URL：** `/admin/auth`  
**调用方式：** PUT

### 请求参数

#### Body 参数 （application/json）

```ts
type AdminUpdateAuthJsonType = {
    username: string;
    password: string;
}
const username = z.string().regex(/^[a-zA-Z0-9_]{1,32}$/, {
  message: '用户名格式错误，长度1到32，只能包含字母、数字和下划线'
})
const password = z.string().regex(/^[a-zA-Z0-9_]{6,32}$/, {
  message: '密码格式错误，长度6到32，只能包含字母、数字和下划线'
})
```

**示例（curl）**

```sh
curl -X PUT \
  http://127.0.0.1:3000/admin/auth \
  -H 'Authorization: Bearer xxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "username": "example_user",
    "password": "example_password"
}'
```

### 返回响应

成功 200

```json
{
    "code":0,
    "message":"修改成功",
}
```

失败 400

```json
{
    "code": 1,
    "message": "修改失败"
}
```



## 获取管理信息

**接口URL：** `/admin/info`  
**调用方式：** GET

**示例（curl）**

```sh
curl -X GET \
  http://127.0.0.1:3000/admin/info \
  -H 'Authorization: Bearer xxx' 
```

### 返回响应

成功 200

```json
{
    "code": 0,
    "message": "获取成功",
    "data": {
        "jwtAdminExpSeconds": 2592000,
        "loginMaxFailCount": 5,
        "loginLockSeconds": 3600,
        "isAuthDefault": true
    }
}
```

失败 400

```json
{
    "code": 1,
    "message": "获取成功"
}
```



## 修改管理信息

**接口URL：** `/admin/info`  
**调用方式：** PUT

### 请求参数

#### Body 参数 （application/json）

```ts
type adminUpdateInfoJsonType = {
    jwtAdminExpSeconds: number;
    loginMaxFailCount: number;
    loginLockSeconds: number;
}
z.number().int().positive()
```

**示例（curl）**

```sh
curl -X PUT \
  http://127.0.0.1:3000/admin/info \
  -H 'Authorization: Bearer xxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "jwtAdminExpSeconds": 2592000,
    "loginMaxFailCount": 10,
    "loginLockSeconds": 3600
}'
```

### 返回响应

成功 200

```json
{
    "code":0,
    "message":"修改成功",
}
```

失败 400

```json
{
    "code": 1,
    "message": "修改失败"
}
```



# 帖子

## 帖子发送

**接口URL：** `/post`  
**调用方式：** POST

### 请求参数

#### Body 参数 （application/json）

```ts
type PostSendJsonType = {
    content: string;
    images: number[];
    createdAt?: Date | undefined;
    parentPostId?: number | undefined;
    twitterId?: string | undefined;
    twitterLink?: string | undefined;
}

const id = z.number().int().positive()
export const postSendJsonSchema = z.object({
  content: z.string(),
  images: z.array(id).max(4),
  createdAt: z.coerce.date()
    .min(new Date('1900-01-01'), { message: 'Too old' })
    .optional(),
  parentPostId: id.optional(),
  twitterId: z.string().optional(),
  twitterLink: z.string().optional()
})
```

**示例（curl）**

```sh
curl -X POST \
  http://127.0.0.1:3000/post \
  -H 'Authorization: Bearer xxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "content": "hello world",
    "images": []
}'
```

### 返回响应

成功 201

```json
{
    "code": 0,
    "message": "发送成功",
    "data": {
        "id": 2,
        "createdAt": "2024-08-15T04:15:46.505Z",
        "addedAt": "2024-08-15T04:15:46.505Z",
        "content": "hello world",
        "isDeleted": false,
        "parentPostId": null,
        "twitterId": null,
        "twitterLink": null
    }
}
```

失败 400

```json
{
    "code": 1,
    "message": "发送失败"
}
```





# 图片

## 图片发送

**接口URL：** `/image`  
**调用方式：** POST

### 请求参数

#### Body 参数 （multipart/form-data）

| 参数名 | 类型 | 必填 | 描述 |
| ------ | ---- | ---- | ---- |
| image  | file | 是   | 图片 |

**示例（curl）**

```sh
curl -X POST \
  http://127.0.0.1:3000/image \
  -H 'Authorization: Bearer xxx' \
  -F 'avatar=@"C:\\image.png"'
```

### 返回响应

成功 201

```json
{
    "code": 0,
    "message": "发送成功",
    "data": {
        "id": 2,
        "createdAt": "2024-08-15T04:15:46.505Z",
        "addedAt": "2024-08-15T04:15:46.505Z",
        "content": "hello world",
        "isDeleted": false,
        "parentPostId": null,
        "twitterId": null,
        "twitterLink": null
    }
}
```

失败 400

```json
{
    "code": 1,
    "message": "发送失败"
}
```

